import React, { useState, useEffect } from 'react';

// --- å…§å»ºåœ–ç¤ºå…ƒä»¶ (ç§»é™¤å¤–éƒ¨ä¾è³´ lucide-reactï¼Œç›´æ¥å…§åµŒ SVG) ---
const Icons = {
  BookOpen: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
    </svg>
  ),
  PenTool: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/>
    </svg>
  ),
  ShoppingBag: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>
    </svg>
  ),
  Clock: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
    </svg>
  ),
  Users: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
    </svg>
  ),
  ChevronDown: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <polyline points="6 9 12 15 18 9"/>
    </svg>
  ),
  ChevronRight: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <polyline points="9 18 15 12 9 6"/>
    </svg>
  ),
  Eye: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
    </svg>
  ),
  Moon: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
  ),
  Sun: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
      <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </svg>
  )
};

// --- è³‡æ–™å€ï¼šå–®å­—åº« ---
const wordBanks = [
  {
    category: "1. ä¼‘é–’èˆ‡æ´»å‹• (Leisure)",
    words: [
      { en: "relax / relieve stress", zh: "æ”¾é¬† / ç´“å£“" },
      { en: "lively atmosphere", zh: "ç†±é¬§çš„æ°£æ°›" },
      { en: "convenient", zh: "æ–¹ä¾¿çš„" },
      { en: "interact with...", zh: "èˆ‡...äº’å‹•" },
      { en: "crowded / noisy", zh: "æ“æ“  / åµé›œ" },
      { en: "peaceful / natural", zh: "å¯§éœ / è‡ªç„¶" }
    ]
  },
  {
    category: "2. ç§‘æŠ€èˆ‡å­¸ç¿’ (Tech & Learning)",
    words: [
      { en: "efficiency / efficient", zh: "æ•ˆç‡ / æœ‰æ•ˆç‡çš„" },
      { en: "distraction / distracted", zh: "åˆ†å¿ƒ / åˆ†å¿ƒçš„" },
      { en: "access information", zh: "å­˜å–è³‡è¨Š" },
      { en: "digital tools", zh: "æ•¸ä½å·¥å…·" },
      { en: "take notes", zh: "åšç­†è¨˜" },
      { en: "shallow / deep", zh: "æ·ºè–„çš„ / æ·±åº¦çš„" }
    ]
  },
  {
    category: "3. æ¶ˆè²»èˆ‡ç”Ÿæ´» (Lifestyle)",
    words: [
      { en: "online shopping", zh: "ç¶²è³¼" },
      { en: "physical store", zh: "å¯¦é«”åº—é¢" },
      { en: "try on", zh: "è©¦ç©¿" },
      { en: "delivery", zh: "é‹é€" },
      { en: "impulse buying", zh: "è¡å‹•è³¼ç‰©" },
      { en: "compare prices", zh: "æ¯”åƒ¹" }
    ]
  },
  {
    category: "4. é‹å‹•èˆ‡å¥åº· (Health)",
    words: [
      { en: "workout / exercise", zh: "å¥èº« / é‹å‹•" },
      { en: "gym", zh: "å¥èº«æˆ¿" },
      { en: "outdoor jogging", zh: "æˆ¶å¤–æ…¢è·‘" },
      { en: "fresh air", zh: "æ–°é®®ç©ºæ°£" },
      { en: "subscription fee", zh: "è¨‚é–±è²»/æœƒè²»" },
      { en: "weather-dependent", zh: "å—å¤©æ°£å½±éŸ¿çš„" }
    ]
  },
  {
    category: "5. äººéš›èˆ‡åˆä½œ (Social)",
    words: [
      { en: "group study", zh: "å°çµ„è®€æ›¸" },
      { en: "study alone", zh: "ç¨è‡ªè®€æ›¸" },
      { en: "share ideas", zh: "åˆ†äº«æƒ³æ³•" },
      { en: "concentration", zh: "å°ˆæ³¨åŠ›" },
      { en: "disturb", zh: "æ‰“æ“¾" },
      { en: "cooperate", zh: "åˆä½œ" }
    ]
  },
  {
    category: "6. è¬ç”¨é€£æ¥è© (Transitions)",
    words: [
      { en: "However, ...", zh: "ç„¶è€Œ" },
      { en: "Therefore, ...", zh: "å› æ­¤" },
      { en: "In addition, ...", zh: "æ­¤å¤–" },
      { en: "For example, ...", zh: "èˆ‰ä¾‹ä¾†èªª" },
      { en: "In other words, ...", zh: "æ›å¥è©±èªª" },
      { en: "As a result, ...", zh: "çµæœ" }
    ]
  }
];

// --- è³‡æ–™å€ï¼š5å€‹æ–°æ¨¡æ“¬é¡Œç›® (å«ç¯„æ–‡) ---
const topics = [
  {
    id: 1,
    title: "ç­†è¨˜æ–¹å¼ (Note-taking)",
    icon: <Icons.PenTool className="w-5 h-5" />,
    type: "comparison",
    context: "ç§‘æŠ€é€²æ­¥ï¼Œå­¸ç”Ÿåšç­†è¨˜çš„æ–¹å¼ä¹Ÿæ”¹è®Šäº†ã€‚",
    imgA: "æ‰‹å¯«ç­†è¨˜ (Handwritten notes) - å°è±¡æ·±ä½†æ…¢",
    imgB: "å¹³æ¿ç­†è¨˜ (Tablet/Digital notes) - å¿«é€Ÿä¸”ç’°ä¿",
    sampleBasic: `The provided pictures present a vivid contrast between two different methods of taking notes. When it comes to taking notes, there is no denying that it is common that students have their own choices. In the first picture, we can see a student writing with a pen and paper. Picture A illustrates a traditional way of learning. On the other hand, the second picture depicts a student using a tablet with a stylus. Obviously, these two scenes offer distinct features and vibes.

From my perspective, I prefer digital notes. The reasons can be summarized as follows. To begin with, it is more efficient to organize files. Therefore, I can find what I need in a second. Second, it is eco-friendly without using paper. In other words, we can save more trees. Last but not least, speaking of my own experience, I once used a tablet for my history class and felt really convenient. In summary, digital notes not only improve my efficiency but also help the environment.`,
    sampleAdvanced: `The provided pictures present a vivid contrast between traditional and modern note-taking strategies. In the first picture, we can see a student diligently writing with a pen, which suggests a focus on memory retention through the physical act of writing. On the other hand, the second picture depicts a student utilizing a tablet, highlighting the convenience and versatility of digital tools. Obviously, these two scenes offer distinct features and vibes: one represents the solid foundation of tradition, while the other symbolizes the speed of technology.

From my perspective, I prefer digital note-taking for its efficiency. The reasons can be summarized as follows. To begin with, digital formats allow for instant editing and cloud synchronization. Therefore, I never have to worry about losing my data. In addition, multimedia functions like recording and inserting images make learning more comprehensive. Speaking of my own experience, I once switched to digital notes for my final exams and found that my review process became much faster. In summary, digital note-taking is an indispensable skill for modern students.`
  },
  {
    id: 2,
    title: "è³¼ç‰©ç¿’æ…£ (Shopping)",
    icon: <Icons.ShoppingBag className="w-5 h-5" />,
    type: "comparison",
    context: "ä½ è¦è²·ä¸€ä»¶æ–°å¤–å¥—ï¼Œä½ æœƒå»å“ªè£¡è²·ï¼Ÿ",
    imgA: "å¯¦é«”åº—é¢ (Physical Store) - å¯è©¦ç©¿ã€ç«‹å³æ‹¿",
    imgB: "ç·šä¸Šè³¼ç‰© (Online Shopping) - æ–¹ä¾¿ã€å¯æ¯”åƒ¹",
    sampleBasic: `The provided pictures present a vivid contrast between two different shopping habits. In the first picture, we can see a crowded physical store with fitting rooms. It seems to be lively but tiring. On the other hand, the second picture depicts a person shopping on a smartphone at home. The atmosphere here is totally different; it looks more relaxing and convenient. Obviously, these two scenes offer distinct features and vibes.

From my perspective, I prefer online shopping. The reasons can be summarized as follows. To begin with, it saves me a lot of time traveling. Therefore, I can spend more time on my studies. Second, I can compare prices easily. In other words, I can save money. Speaking of my own experience, I once bought a coat online and got a huge discount. In summary, online shopping not only saves time but also saves money.`,
    sampleAdvanced: `The provided pictures present a vivid contrast between conventional and digital shopping modes. In the first picture, we can see a physical store where customers can try on clothes, offering an immediate tactile experience. On the other hand, the second picture depicts the growing trend of e-commerce, where a person shops conveniently on a smartphone. Obviously, these two scenes offer distinct features: one emphasizes experience and certainty, while the other prioritizes convenience and efficiency.

From my perspective, I prefer online shopping. The reasons can be summarized as follows. To begin with, the internet provides a wider variety of choices that physical stores cannot match. As a result, I can always find exactly what I want. In addition, user reviews and price comparison tools help me make smarter decisions. Speaking of my own experience, I once found a rare book online that was out of stock in all local bookstores. In summary, the convenience and accessibility of online shopping make it my top choice.`
  },
  {
    id: 3,
    title: "é‹å‹•å ´åŸŸ (Exercise)",
    icon: <Icons.Clock className="w-5 h-5" />,
    type: "comparison",
    context: "ä¿æŒå¥åº·å¾ˆé‡è¦ï¼Œä½†å ´åœ°é¸æ“‡å„æœ‰å„ªç¼ºã€‚",
    imgA: "æˆ¶å¤–æ…¢è·‘ (Outdoor Jogging) - é¢¨æ™¯å¥½ã€ç©ºæ°£ä½³",
    imgB: "å®¤å…§å¥èº«æˆ¿ (Indoor Gym) - è¨­å‚™å¤šã€ä¸å—å¤©æ°£å½±éŸ¿",
    sampleBasic: `The provided pictures present a vivid contrast between two different places for exercise. In the first picture, we can see people jogging in a park with fresh air. Picture A illustrates a healthy lifestyle in nature. On the other hand, the second picture depicts people running on treadmills in a gym. It seems to be professional and convenient. Obviously, these two scenes offer distinct features and vibes.

From my perspective, I prefer outdoor jogging. The reasons can be summarized as follows. To begin with, I can get close to nature. Therefore, I feel more relaxed. Second, it is free of charge. In other words, I don't need to pay for a membership. Speaking of my own experience, I once jogged by the river and felt really refreshed. In summary, outdoor jogging not only improves my health but also saves my money.`,
    sampleAdvanced: `The provided pictures present a vivid contrast between outdoor and indoor exercise environments. In the first picture, we can see people jogging in a park, enjoying the fresh air and natural scenery. On the other hand, the second picture depicts a well-equipped gym where people exercise regardless of the weather. Obviously, these two scenes offer distinct features: one connects us with nature, while the other offers a controlled and efficient workout setting.

From my perspective, I prefer outdoor jogging. The reasons can be summarized as follows. To begin with, fresh air and changing sceneries can significantly reduce mental stress. As a result, exercise becomes a mental therapy, not just physical training. Second, it is a flexible activity that requires no commute or expensive fees. Speaking of my own experience, I once maintained a habit of morning jogging for a month and felt much more energetic during the day. In summary, outdoor jogging is a holistic approach to well-being.`
  },
  {
    id: 4,
    title: "è®€æ›¸æ¨¡å¼ (Study Mode)",
    icon: <Icons.Users className="w-5 h-5" />,
    type: "comparison",
    context: "åœ–æ›¸é¤¨è£¡å¸¸è¦‹çš„å…©ç¨®æ™¯è±¡ã€‚",
    imgA: "ç¨è‡ªè‹¦è®€ (Studying Alone) - å®‰éœã€å°ˆæ³¨",
    imgB: "å°çµ„è¨è«– (Group Study) - äº¤æµã€äº’åŠ©",
    sampleBasic: `The provided pictures present a vivid contrast between two different study modes. In the first picture, we can see a student studying alone quietly. It seems to be serious and focused. On the other hand, the second picture depicts a group of students discussing homework together. The atmosphere here is lively. Obviously, these two scenes offer distinct features and vibes.

From my perspective, I prefer studying alone. The reasons can be summarized as follows. To begin with, I can concentrate better without noise. Therefore, I can study faster. Second, I can follow my own pace. In other words, I don't need to wait for others. Speaking of my own experience, I once studied alone for a big test and got a high score. In summary, studying alone is the best way for me to learn.`,
    sampleAdvanced: `The provided pictures present a vivid contrast between solitary learning and collaborative study. In the first picture, we can see a student immersed in books alone, minimizing external distractions. On the other hand, the second picture depicts a group study session, fostering the exchange of ideas and teamwork. Obviously, these two scenes offer distinct features: one ensures deep focus, while the other promotes intellectual stimulation through discussion.

From my perspective, I prefer studying alone. The reasons can be summarized as follows. To begin with, solitary study allows for deep work, which is essential for mastering complex concepts. As a result, my efficiency is maximized. In addition, I can tailor the schedule to my specific weaknesses without compromising for the group. Speaking of my own experience, I once tried group study but ended up chatting too much; since then, I stick to studying alone. In summary, self-study provides the discipline and focus I need to succeed.`
  },
  {
    id: 5,
    title: "é«˜ä¸­ç”Ÿçš„å£“åŠ› (Pressure)",
    icon: <Icons.BookOpen className="w-5 h-5" />,
    type: "phenomenon",
    context: "é«˜ä¸­ç”Ÿé¢è‡¨å„ç¨®å£“åŠ›ä¾†æºã€‚",
    imgA: "å †ç©å¦‚å±±çš„è€ƒå· (Academic Pressure)",
    imgB: "åœ¨æ„åŒå„•çœ¼å…‰/ç¤¾ç¾¤ç„¦æ…® (Peer Pressure)",
    sampleBasic: `The picture displays a common phenomenon regarding high school students' stress. Among the examples shown, one is struggling with piles of test papers. Another shows worrying about friends' opinions on social media. Undoubtedly, these images reflect the real situations we often encounter.

From my perspective, I prefer finding a balance. The reasons can be summarized as follows. To begin with, mental health is important. Therefore, we should not push ourselves too hard. Second, we should seek help when needed. In other words, talking to teachers or parents is good. Speaking of my own experience, I once felt very stressed about grades, but I felt better after talking to my mom. In summary, it is important for us to stay positive and healthy.`,
    sampleAdvanced: `The picture displays a common phenomenon regarding the multifaceted pressures facing teenagers today. Among the examples shown, one is the overwhelming academic burden, represented by mountains of test papers. Another shows the anxiety that stems from peer pressure, often amplified by social media interactions. Undoubtedly, these images highlight the intense challenges of modern adolescence.

From my perspective, I believe facing these pressures requires resilience and a balanced mindset. The reasons can be summarized as follows. To begin with, academic success should not come at the expense of mental health. Therefore, learning to manage time and stress is crucial. In addition, we must realize that social media often presents an unrealistic reality. Speaking of my own experience, I once suffered from "FOMO" (fear of missing out), but I learned to focus on my own progress rather than comparing myself to others. In summary, maintaining a healthy mind is the key to overcoming these pressures.`
  }
];

// --- ä¸»ç¨‹å¼ ---
export default function CompositionApp() {
  const [currentTopicId, setCurrentTopicId] = useState(1);
  const [inputs, setInputs] = useState({});
  const [showWordBank, setShowWordBank] = useState(true);
  const [showSample, setShowSample] = useState(false);
  const [sampleLevel, setSampleLevel] = useState('basic'); // 'basic' | 'advanced'
  const [darkMode, setDarkMode] = useState(false);

  const currentTopic = topics.find(t => t.id === currentTopicId);

  // åˆ‡æ›é¡Œç›®æ™‚é‡ç½®ç‹€æ…‹
  useEffect(() => {
    setInputs({});
    setShowSample(false);
    setSampleLevel('basic');
  }, [currentTopicId]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setInputs(prev => ({ ...prev, [name]: value }));
  };

  // GitHub Theme Colors
  // Light: bg-gray-50, text-gray-800, border-gray-200, card-white
  // Dark: bg-[#0d1117] (main), bg-[#161b22] (card), border-[#30363d], text-[#c9d1d9]
  
  const theme = {
    bg: darkMode ? 'bg-[#0d1117]' : 'bg-gray-50',
    text: darkMode ? 'text-[#c9d1d9]' : 'text-gray-800',
    cardBg: darkMode ? 'bg-[#161b22]' : 'bg-white',
    cardBorder: darkMode ? 'border-[#30363d]' : 'border-gray-200',
    inputBg: darkMode ? 'bg-[#0d1117]' : 'bg-white',
    inputBorder: darkMode ? 'border-[#30363d] focus:border-[#58a6ff]' : 'border-gray-300 focus:ring-blue-400',
    heading: darkMode ? 'text-white' : 'text-blue-800',
    subtext: darkMode ? 'text-gray-400' : 'text-gray-600',
    accentBg: darkMode ? 'bg-[#1f6feb]' : 'bg-blue-600',
    accentText: 'text-white',
    buttonHover: darkMode ? 'hover:bg-[#30363d]' : 'hover:bg-blue-50',
    sampleBasicBtn: darkMode ? 'bg-[#238636] text-white border-transparent' : 'bg-orange-500 text-white shadow',
    sampleAdvBtn: darkMode ? 'bg-[#8957e5] text-white border-transparent' : 'bg-purple-600 text-white shadow',
    wordBankHeader: darkMode ? 'text-[#c9d1d9]' : 'text-gray-700',
    wordBankHover: darkMode ? 'hover:bg-[#0d1117]' : 'hover:bg-gray-50',
  };

  const WordBankSection = () => (
    <div className={`${theme.cardBg} rounded-lg shadow-sm border ${theme.cardBorder} p-4 mb-4 transition-colors duration-300`}>
      <div 
        className="flex justify-between items-center cursor-pointer mb-2"
        onClick={() => setShowWordBank(!showWordBank)}
      >
        <h3 className={`font-bold ${theme.wordBankHeader} flex items-center gap-2`}>
          <Icons.BookOpen className="w-4 h-4" /> è¬ç”¨å–®å­—åº« (é»æ“Šæ”¶åˆ)
        </h3>
        {showWordBank ? <Icons.ChevronDown className="w-4 h-4"/> : <Icons.ChevronRight className="w-4 h-4"/>}
      </div>
      
      {showWordBank && (
        <div className="space-y-3 h-64 overflow-y-auto pr-2 custom-scrollbar">
          {wordBanks.map((bank, idx) => (
            <div key={idx} className={`border-b ${darkMode ? 'border-[#30363d]' : 'border-gray-100'} pb-2 last:border-0`}>
              <h4 className={`text-sm font-semibold mb-1 ${darkMode ? 'text-[#58a6ff]' : 'text-blue-600'}`}>{bank.category}</h4>
              <div className="grid grid-cols-1 gap-1">
                {bank.words.map((w, wIdx) => (
                  <div key={wIdx} className={`text-xs flex justify-between group ${theme.wordBankHover} p-1 rounded transition-colors`}>
                    <span className={`${theme.text} font-medium`}>{w.en}</span>
                    <span className={theme.subtext}>{w.zh}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );

  return (
    <div className={`min-h-screen font-sans ${theme.bg} ${theme.text} p-4 md:p-8 transition-colors duration-300`}>
      <div className="max-w-6xl mx-auto">
        <header className="mb-6 flex flex-col md:flex-row justify-between items-center md:items-start text-center md:text-left gap-4">
          <div>
            <h1 className={`text-3xl font-bold ${theme.heading} mb-2`}>å­¸æ¸¬è‹±æ–‡ä½œæ–‡ï¼šè¬ç”¨æ¨¡ç‰ˆç·´ç¿’ç¥å™¨</h1>
            <p className={theme.subtext}>é¸æ“‡é¡Œç›®ï¼Œå¡«å…¥é—œéµå­—ï¼Œè¼•é¬†ç·´ç¿’ç¬¬ä¸€æ®µèˆ‡ç¬¬äºŒæ®µå¯«ä½œï¼</p>
          </div>
          <button 
            onClick={() => setDarkMode(!darkMode)}
            className={`flex items-center gap-2 px-4 py-2 rounded-full border ${theme.cardBorder} ${theme.cardBg} ${theme.text} hover:opacity-80 transition-all`}
          >
            {darkMode ? <Icons.Sun className="w-4 h-4 text-yellow-400" /> : <Icons.Moon className="w-4 h-4 text-gray-600" />}
            <span className="text-sm font-medium">{darkMode ? "Light Mode" : "GitHub Dark"}</span>
          </button>
        </header>

        {/* é¡Œç›®é¸æ“‡å€ */}
        <div className="flex overflow-x-auto gap-2 mb-6 pb-2 custom-scrollbar">
          {topics.map(topic => (
            <button
              key={topic.id}
              onClick={() => setCurrentTopicId(topic.id)}
              className={`flex items-center gap-2 px-4 py-3 rounded-lg border transition-all whitespace-nowrap ${
                currentTopicId === topic.id
                  ? `${theme.accentBg} ${theme.accentText} border-transparent shadow-md`
                  : `${theme.cardBg} ${theme.subtext} ${theme.cardBorder} ${theme.buttonHover}`
              }`}
            >
              {topic.icon}
              <span className="font-medium">{topic.title}</span>
            </button>
          ))}
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
          
          {/* å·¦å´ï¼šé¡Œç›®è³‡è¨Š + å–®å­—åº« (ä½” 3/12) */}
          <div className="lg:col-span-3 space-y-4">
            <div className={`${darkMode ? 'bg-[#1f2428] border-[#30363d]' : 'bg-blue-50 border-blue-100'} rounded-lg p-5 border`}>
              <h2 className={`font-bold mb-3 text-lg flex items-center gap-2 ${darkMode ? 'text-[#58a6ff]' : 'text-blue-800'}`}>
                <Icons.Clock className="w-5 h-5"/> ç•¶å‰é¡Œç›®
              </h2>
              <div className="space-y-4">
                <p className={`text-sm ${theme.text}`}>{currentTopic.context}</p>
                <div className={`${theme.cardBg} p-3 rounded shadow-sm border-l-4 ${darkMode ? 'border-[#1f6feb]' : 'border-blue-400'}`}>
                  <span className="text-xs font-bold text-gray-400 uppercase">Picture A / 1</span>
                  <p className={`text-sm font-medium ${theme.text}`}>{currentTopic.imgA}</p>
                </div>
                <div className={`${theme.cardBg} p-3 rounded shadow-sm border-l-4 ${darkMode ? 'border-[#238636]' : 'border-green-400'}`}>
                  <span className="text-xs font-bold text-gray-400 uppercase">Picture B / 2</span>
                  <p className={`text-sm font-medium ${theme.text}`}>{currentTopic.imgB}</p>
                </div>
              </div>
            </div>

            <WordBankSection />
          </div>

          {/* ä¸­é–“ï¼šå¡«ç©ºç·´ç¿’å€ (æ”¾å¤§è‡³ 9/12) */}
          <div className="lg:col-span-9 space-y-6">
            
            {/* å¡«ç©ºç·´ç¿’å€å¡Š */}
            <div className={`${theme.cardBg} rounded-xl shadow-sm border ${theme.cardBorder} p-6 transition-colors duration-300`}>
               <div className={`flex justify-between items-center mb-4 border-b ${darkMode ? 'border-[#30363d]' : 'border-gray-200'} pb-2`}>
                  <h2 className={`text-xl font-bold ${theme.text}`}>âœï¸ å¡«ç©ºç·´ç¿’</h2>
                  <span className={`text-xs ${darkMode ? 'bg-[#0d1117] text-[#8b949e]' : 'bg-gray-100 text-gray-500'} px-2 py-1 rounded`}>
                    {currentTopic.type === 'comparison' ? 'é©ç”¨ï¼šäºŒé¸ä¸€æ¯”è¼ƒæ¨¡æ¿' : 'é©ç”¨ï¼šå¤šåœ–/ç¾è±¡æ¨¡æ¿'}
                  </span>
               </div>

              <form className="space-y-6" onSubmit={(e) => e.preventDefault()}>
                
                {/* ç¬¬ä¸€æ®µ */}
                <div className="space-y-4">
                  <h3 className={`text-sm font-bold ${darkMode ? 'text-[#58a6ff] bg-[#0d1117] border border-[#30363d]' : 'text-blue-600 bg-blue-50'} inline-block px-2 py-1 rounded`}>ç¬¬ä¸€æ®µï¼šç¾è±¡æè¿°</h3>
                  
                  {currentTopic.type === 'comparison' ? (
                    /* äºŒé¸ä¸€æ¨¡æ¿è¼¸å…¥ */
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-1 md:col-span-2">
                        <label className={`text-xs font-semibold ${theme.subtext}`}>ä¸»é¡Œ (Topic) - å¥å‹ï¼šThe provided pictures present a vivid contrast between two different [ä¸»é¡Œ].</label>
                        <input 
                          name="theme" 
                          placeholder="è«‹è¼¸å…¥ä¸»é¡Œ (ä¾‹å¦‚ï¼šdifferent types of...)"
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.theme || ''}
                        />
                      </div>
                      <div className="space-y-1">
                        <label className={`text-xs font-semibold ${theme.subtext}`}>åœ– A æè¿° (Description A) - å¥å‹ï¼šIn the first picture, we can see [åœ–Aæè¿°].</label>
                        <textarea 
                          name="descA" 
                          rows="3"
                          placeholder="è«‹æè¿°åœ– A çš„å…§å®¹..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.descA || ''}
                        />
                      </div>
                      <div className="space-y-1">
                        <label className={`text-xs font-semibold ${theme.subtext}`}>åœ– B æè¿° (Description B) - å¥å‹ï¼šOn the other hand, the second picture depicts [åœ–Bæè¿°].</label>
                        <textarea 
                          name="descB" 
                          rows="3"
                          placeholder="è«‹æè¿°åœ– B çš„å…§å®¹..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.descB || ''}
                        />
                      </div>
                    </div>
                  ) : (
                    /* ç¾è±¡æ¨¡æ¿è¼¸å…¥ */
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-1 md:col-span-2">
                        <label className={`text-xs font-semibold ${theme.subtext}`}>ä¸»é¡Œ (Topic) - å¥å‹ï¼šThe picture displays a common phenomenon regarding [ä¸»é¡Œ].</label>
                        <input 
                          name="theme" 
                          placeholder="è«‹è¼¸å…¥ä¸»é¡Œ..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.theme || ''}
                        />
                      </div>
                      <div className="space-y-1">
                        <label className={`text-xs font-semibold ${theme.subtext}`}>åœ–ç‰‡ 1 æè¿° (Description 1) - å¥å‹ï¼šAmong the examples shown, one is [åœ–ç‰‡1æè¿°].</label>
                        <input 
                          name="desc1" 
                          placeholder="è«‹æè¿°ç¬¬ä¸€ç¨®ç¾è±¡..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.desc1 || ''}
                        />
                      </div>
                      <div className="space-y-1">
                        <label className={`text-xs font-semibold ${theme.subtext}`}>åœ–ç‰‡ 2 æè¿° (Description 2) - å¥å‹ï¼šAnother shows [åœ–ç‰‡2æè¿°].</label>
                        <input 
                          name="desc2" 
                          placeholder="è«‹æè¿°ç¬¬äºŒç¨®ç¾è±¡..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.desc2 || ''}
                        />
                      </div>
                    </div>
                  )}
                </div>

                <hr className={darkMode ? 'border-[#30363d]' : 'border-gray-100'} />

                {/* ç¬¬äºŒæ®µ */}
                <div className="space-y-4">
                   <h3 className={`text-sm font-bold ${darkMode ? 'text-[#238636] bg-[#0d1117] border border-[#30363d]' : 'text-green-600 bg-green-50'} inline-block px-2 py-1 rounded`}>ç¬¬äºŒæ®µï¼šå€‹äººçœ‹æ³•</h3>
                   <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-1 md:col-span-2">
                          <label className={`text-xs font-semibold ${theme.subtext}`}>ä½ çš„é¸æ“‡ (Your Preference) - å¥å‹ï¼šFrom my perspective, I prefer [ä½ çš„é¸æ“‡].</label>
                          <input 
                          name="myChoice" 
                          placeholder="è«‹è¼¸å…¥ä½ çš„é¸æ“‡/çœ‹æ³•..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.myChoice || ''}
                          />
                      </div>
                      <div className="space-y-1">
                          <label className={`text-xs font-semibold ${theme.subtext}`}>ç†ç”±ä¸€ (Reason 1) - å¥å‹ï¼šTo begin with, [ç†ç”±ä¸€].</label>
                          <input 
                          name="reason1" 
                          placeholder="ç¬¬ä¸€å€‹åŸå› ..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.reason1 || ''}
                          />
                      </div>
                      <div className="space-y-1">
                          <label className={`text-xs font-semibold ${theme.subtext}`}>ç†ç”±äºŒ (Reason 2) - å¥å‹ï¼šSecond, [ç†ç”±äºŒ].</label>
                          <input 
                          name="reason2" 
                          placeholder="ç¬¬äºŒå€‹åŸå› ..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.reason2 || ''}
                          />
                      </div>
                      <div className="space-y-1 md:col-span-2">
                          <label className={`text-xs font-semibold ${theme.subtext}`}>è‡ªèº«ç¶“é©— (Past Experience) - å¥å‹ï¼šSpeaking of my own experience, I once [è‡ªèº«ç¶“é©—].</label>
                          <textarea 
                          name="experience" 
                          rows="2"
                          placeholder="è«‹ç°¡è¿°ä½ çš„ç›¸é—œç¶“é©—..."
                          className={`w-full p-2 border rounded outline-none ${theme.inputBg} ${theme.inputBorder} ${theme.text}`}
                          onChange={handleInputChange} value={inputs.experience || ''}
                          />
                      </div>
                    </div>
                </div>
              </form>
            </div>

            {/* ç¯„æ–‡åƒè€ƒå€å¡Š */}
            <div className={`${darkMode ? 'bg-[#161b22] border-[#30363d]' : 'bg-orange-50 border-orange-200'} rounded-xl shadow-sm border p-6 transition-colors duration-300`}>
              <div 
                className="flex justify-between items-center cursor-pointer"
                onClick={() => setShowSample(!showSample)}
              >
                <h2 className={`text-xl font-bold flex items-center gap-2 ${darkMode ? 'text-[#ff7b72]' : 'text-orange-800'}`}>
                   <Icons.Eye className="w-5 h-5" /> åƒè€ƒç¯„æ–‡ (Sample Essays)
                </h2>
                <div className={`flex items-center gap-2 text-sm ${darkMode ? 'text-gray-400' : 'text-orange-600'}`}>
                  {showSample ? "é»æ“Šæ”¶åˆ" : "å¯«å®Œå†çœ‹ï¼é»æ“Šå±•é–‹"}
                  {showSample ? <Icons.ChevronDown className="w-4 h-4"/> : <Icons.ChevronRight className="w-4 h-4"/>}
                </div>
              </div>

              {showSample && (
                <div className="mt-4 animate-in fade-in slide-in-from-top-2 duration-300">
                  <div className="flex gap-2 mb-4">
                    <button 
                      onClick={() => setSampleLevel('basic')}
                      className={`px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${
                        sampleLevel === 'basic' 
                        ? theme.sampleBasicBtn
                        : `${theme.cardBg} ${theme.subtext} border ${theme.cardBorder} hover:opacity-80`
                      }`}
                    >
                      ğŸŒ± åŸºç¤ç‰ˆ (Basic)
                    </button>
                    <button 
                      onClick={() => setSampleLevel('advanced')}
                      className={`px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${
                        sampleLevel === 'advanced' 
                        ? theme.sampleAdvBtn
                        : `${theme.cardBg} ${theme.subtext} border ${theme.cardBorder} hover:opacity-80`
                      }`}
                    >
                      ğŸš€ é€²éšç‰ˆ (Advanced)
                    </button>
                  </div>
                  
                  <div className={`${theme.cardBg} p-6 rounded-lg border ${darkMode ? 'border-[#30363d]' : (sampleLevel === 'basic' ? 'border-orange-200' : 'border-purple-200')} shadow-sm`}>
                     <div className="mb-2 flex items-center gap-2">
                        {sampleLevel === 'basic' ? (
                          <span className={`text-xs px-2 py-1 rounded font-bold ${darkMode ? 'bg-[#238636] text-white' : 'bg-orange-100 text-orange-800'}`}>åš´æ ¼å¥—ç”¨æ¨¡æ¿</span>
                        ) : (
                          <span className={`text-xs px-2 py-1 rounded font-bold ${darkMode ? 'bg-[#8957e5] text-white' : 'bg-purple-100 text-purple-800'}`}>éˆæ´»å¥å‹è®ŠåŒ–</span>
                        )}
                     </div>
                     <p className={`whitespace-pre-wrap leading-relaxed font-serif text-lg ${theme.text}`}>
                       {sampleLevel === 'basic' ? currentTopic.sampleBasic : currentTopic.sampleAdvanced}
                     </p>
                  </div>
                  <p className={`text-center text-xs mt-3 ${theme.subtext}`}>
                    * å»ºè­°å…ˆå˜—è©¦è‡ªå·±å¯«ï¼Œå†å°ç…§ç¯„æ–‡å­¸ç¿’ *
                  </p>
                </div>
              )}
            </div>

          </div>

        </div>
      </div>
    </div>
  );
}